from micropython import const


MPR121_I2C_address = const(0x5A)

MPR121_ELE_L = const(0x00)
MPR121_ELE_H = const(0x01) 
MPR121_OOR_STATU = const(0x02)          
MPR121_ELEPROX = const(0x03)
MPR121_ELE0_L = const(0x04) 
MPR121_ELE0_H = const(0x05) 
MPR121_ELE1_L = const(0x06) 
MPR121_ELE1_H = const(0x07) 
MPR121_ELE2_L = const(0x08) 
MPR121_ELE2_H = const(0x09) 
MPR121_ELE3_L = const(0x0A) 
MPR121_ELE3_H = const(0x0B)
MPR121_ELE4_L = const(0x0C) 
MPR121_ELE4_H = const(0x0D)        
MPR121_ELE5_L = const(0x0E) 
MPR121_ELE5_H = const(0x0F)
MPR121_ELE6_L = const(0x10) 
MPR121_ELE6_H = const(0x11) 
MPR121_ELE7_L = const(0x12) 
MPR121_ELE7_H = const(0x13)
MPR121_ELE8_L = const(0x14) 
MPR121_ELE8_H = const(0x15)
MPR121_ELE9_L = const(0x16) 
MPR121_ELE9_H = const(0x17) 
MPR121_ELE10_L = const(0x18) 
MPR121_ELE10_H = const(0x19)  
MPR121_ELE11_L = const(0x1A) 
MPR121_ELE11_H = const(0x1B) 
MPR121_EFDPROX_L = const(0x1C) 
MPR121_EFDPROX_H = const(0x1D) 
MPR121_E0BV = const(0x1E) 
MPR121_E1BV = const(0x1F) 
MPR121_E2BV = const(0x20)
MPR121_E3BV = const(0x21) 
MPR121_E4BV = const(0x22)
MPR121_E5BV = const(0x23)  
MPR121_E6BV = const(0x24)
MPR121_E7BV = const(0x25) 
MPR121_E8BV = const(0x26)
MPR121_E9BV = const(0x27)  
MPR121_E10BV  = const(0x28)
MPR121_E11BV  = const(0x29)  
MPR121_EPROXBV = const(0x2A)  
MPR121_MHD_R  = const(0x2B) 
MPR121_NHD_R  = const(0x2C)        
MPR121_NCL_R  = const(0x2D)     
MPR121_FDL_R  = const(0x2E)  
MPR121_MHD_F  = const(0x2F)
MPR121_NHD_F  = const(0x30)
MPR121_NCL_F  = const(0x31)
MPR121_FDL_F  = const(0x32)
MPR121_NHD_T  = const(0x33)  
MPR121_NCL_T  = const(0x34)
MPR121_FDL_T  = const(0x35)
MPR121_MHDPROXR = const(0x36)
MPR121_NHDPROXR = const(0x37)
MPR121_NCLPROXR = const(0x38)
MPR121_FDLPROXR = const(0x39)
MPR121_MHDPROXF = const(0x3A)
MPR121_NHDPROXF = const(0x3B)
MPR121_NCLPROXF = const(0x3C)
MPR121_FDLPROXF = const(0x3D)
MPR121_NHDPROXT = const(0x3E)
MPR121_NCLPROXT = const(0x3F)
MPR121_FDLPROXT = const(0x40)
MPR121_ELE0_T = const(0x41)
MPR121_ELE0_R = const(0x42)
MPR121_ELE1_T = const(0x43)
MPR121_ELE1_R = const(0x44)
MPR121_ELE2_T = const(0x45)
MPR121_ELE2_R = const(0x46)
MPR121_ELE3_T = const(0x47)
MPR121_ELE3_R = const(0x48)
MPR121_ELE4_T = const(0x49)
MPR121_ELE4_R = const(0x4A)
MPR121_ELE5_T = const(0x4B)       
MPR121_ELE5_R = const(0x4C)
MPR121_ELE6_T = const(0x4D)
MPR121_ELE6_R = const(0x4E)
MPR121_ELE7_T = const(0x4F)
MPR121_ELE7_R = const(0x50)
MPR121_ELE8_T = const(0x51)
MPR121_ELE8_R = const(0x52)
MPR121_ELE9_T = const(0x53)
MPR121_ELE9_R = const(0x54)
MPR121_ELE10_T = const(0x55)
MPR121_ELE10_R = const(0x56)
MPR121_ELE11_T = const(0x57)
MPR121_ELE11_R = const(0x58)
MPR121_EPROXTTH = const(0x59) 
MPR121_EPROXRTH = const(0x5A)
MPR121_DEBOUNCE = const(0x5B)
MPR121_FIL_CFG1 = const(0x5C)
MPR121_FIL_CFG2 = const(0x5D)
MPR121_ELE_CFG = const(0x5E)
MPR121_CDC0 = const(0x5F)
MPR121_CDC1 = const(0x60)
MPR121_CDC2 = const(0x61)
MPR121_CDC3 = const(0x62)
MPR121_CDC4 = const(0x63)
MPR121_CDC5 = const(0x64)
MPR121_CDC6 = const(0x65)
MPR121_CDC7 = const(0x66)
MPR121_CDC8 = const(0x67)
MPR121_CDC9 = const(0x68)
MPR121_CDC10 = const(0x69)
MPR121_CDC11 = const(0x6A)
MPR121_CDCPROX = const(0x6B)
MPR121_CDT0_1 = const(0x6C)
MPR121_CDT2_3 = const(0x6D)
MPR121_CDT4_5 = const(0x6E)
MPR121_CDT6_7 = const(0x6F)
MPR121_CDT8_9 = const(0x70)
MPR121_CDT10_11 = const(0x71)
MPR121_CDTPROX = const(0x72)
MPR121_GPIO_CTRL0 = const(0x73)
MPR121_GPIO_CTRL1 = const(0x74)
MPR121_GPIO_DATA = const(0x75)
MPR121_GPIO_DIR = const(0x76)
MPR121_GPIO_EN = const(0x77)
MPR121_GPIO_SET = const(0x78)
MPR121_GPIO_CLEAR = const(0x79)
MPR121_GPIO_TOGGLE = const(0x7A)
MPR121_AUTO_CFG0 = const(0x7B) 
MPR121_AUTO_CFG_CTRL = const(0x7C)
MPR121_AUTO_CFGU = const(0x7D)  
MPR121_AUTO_CFGL = const(0x7E)
MPR121_AUTO_CFGT  = const(0x7F)      
MPR121_SRST = const(0x80)
MPR121_TOU_THRESH = const(0x0F)
MPR121_REL_THRESH = const(0x0A)
                     

class MPR121():
    def __init__(self, _i2c, default_i2c_address = MPR121_I2C_address):
        self.i2c = _i2c
        self.addr = default_i2c_address
        self.init()
        
        
    def write(self, reg, value):
        if not type(value) is bytearray:
            value = bytearray([value])        
        self.i2c.writeto_mem(self.addr, reg, value)
        
        
    def read(self, reg):
        retval = self.i2c.readfrom_mem(self.addr, reg, 0x01)    
        return retval[0x00]
    
    
    def init(self):  
        self.write(MPR121_MHD_R, 0x01)
        self.write(MPR121_NHD_R, 0x01)                          
        self.write(MPR121_NCL_R, 0x00)                 
        self.write(MPR121_FDL_R, 0x00)      
        self.write(MPR121_MHD_F, 0x01)
        self.write(MPR121_NHD_F, 0x01)             
        self.write(MPR121_NCL_F, 0xFF)
        self.write(MPR121_FDL_F, 0x02) 
        self.write(MPR121_ELE0_T, MPR121_TOU_THRESH)
        self.write(MPR121_ELE0_R, MPR121_REL_THRESH)
        self.write(MPR121_ELE1_T, MPR121_TOU_THRESH)
        self.write(MPR121_ELE1_R, MPR121_REL_THRESH)
        self.write(MPR121_ELE2_T, MPR121_TOU_THRESH)
        self.write(MPR121_ELE2_R, MPR121_REL_THRESH)
        self.write(MPR121_ELE3_T, MPR121_TOU_THRESH)        
        self.write(MPR121_ELE3_R, MPR121_REL_THRESH)        
        self.write(MPR121_ELE4_T, MPR121_TOU_THRESH)
        self.write(MPR121_ELE4_R, MPR121_REL_THRESH)
        self.write(MPR121_ELE5_T, MPR121_TOU_THRESH)
        self.write(MPR121_ELE5_R, MPR121_REL_THRESH)
        self.write(MPR121_ELE6_T, MPR121_TOU_THRESH)
        self.write(MPR121_ELE6_R, MPR121_REL_THRESH)
        self.write(MPR121_ELE7_T, MPR121_TOU_THRESH)        
        self.write(MPR121_ELE7_R, MPR121_REL_THRESH)        
        self.write(MPR121_ELE8_T, MPR121_TOU_THRESH)
        self.write(MPR121_ELE8_R, MPR121_REL_THRESH)
        self.write(MPR121_ELE9_T, MPR121_TOU_THRESH)
        self.write(MPR121_ELE9_R, MPR121_REL_THRESH)
        self.write(MPR121_ELE10_T, MPR121_TOU_THRESH)
        self.write(MPR121_ELE10_R, MPR121_REL_THRESH)
        self.write(MPR121_ELE11_T, MPR121_TOU_THRESH)        
        self.write(MPR121_ELE11_R, MPR121_REL_THRESH)
        self.write(MPR121_AUTO_CFG0, 0x1B)         
        self.write(MPR121_AUTO_CFGU, 0xC9)  
        self.write(MPR121_AUTO_CFGL, 0x82) 
        self.write(MPR121_AUTO_CFGT,0xB5)
        self.write(MPR121_ELE_CFG, 0x0C)
        
    
    def get_sensors(self):
        ts = self.read(MPR121_ELE_H)
        ts <<= 8
        ts |= self.read(MPR121_ELE_L)
        
        return ts